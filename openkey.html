<!DOCTYPE html>
<html>
<head>
    <title>OpenKey App</title>
    <style>
        /* Add some basic styles for the loader */
        .loader {
            border: 16px solid #f3f3f3;
            border-radius: 50%;
            border-top: 16px solid #3498db;
            width: 120px;
            height: 120px;
            animation: spin 2s linear infinite;
            margin: 100px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="loader"></div>
    <script type="text/javascript">
        function getQueryParams(url) {
            var params = {};
            var parser = document.createElement('a');
            parser.href = url;
            var query = parser.search.substring(1);
            var vars = query.split('&');
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split('=');
                params[pair[0]] = decodeURIComponent(pair[1]);
            }
            return params;
        }

        var params = getQueryParams(window.location.href);
        var paramString = Object.keys(params).map(key => key + '=' + params[key]).join('&');

        // Attempt to open the development version
        setTimeout(function() {
            window.location.href = "intent://openkey#Intent;scheme=https;package=com.openkey.guest.dev;end?" + paramString;
        }, 100);

        // Fallback to open the production version if the dev version is not installed
        setTimeout(function() {
            window.location.href = "intent://openkey#Intent;scheme=https;package=com.openkey.guest;end?" + paramString;
        }, 500);

        // Final fallback to the Play Store redirect page if neither app is installed
        setTimeout(function() {
            window.location.href = "https://play.google.com/store/apps/details?id=com.openkey.guest&" + paramString;
        }, 1500);
    </script>
</body>
</html>
